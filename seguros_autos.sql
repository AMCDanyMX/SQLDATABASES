--TABLA CLIENTE--
CREATE TABLE CLIENTE(
ID_CLIENTE CHAR(6) CONSTRAINT CLIENTE_PK PRIMARY KEY,
NOMBRE VARCHAR2(50) CONSTRAINT CLI_NOM_NN NOT NULL,
APATERNO VARCHAR2(50) CONSTRAINT CLI_AP_NN NOT NULL,
AMATERNO VARCHAR2(50) ,
TELEFONO VARCHAR2(10),
CORREO VARCHAR2(50)
);

INSERT INTO CLIENTE VALUES('1','DANIEL','MORALES','CASTILLO','4922190147','DAMC@GMAIL.COM');
INSERT INTO CLIENTE VALUES('2','JUAN','DOMINGUEZ','SALAS','4922228767','JDS@GMAIL.COM');
INSERT INTO CLIENTE VALUES('3','ALEXA','ALVARADO','CASTILLO','4921345566','AAC@GMAIL.COM');
INSERT INTO CLIENTE VALUES('4','ANGELICA','CASTILLO','GONZALEZ','4922334567','ACG@GMAIL.COM');
INSERT INTO CLIENTE VALUES('5','ALFREDO','MENDEZ','ROBLES','4921124567','AMR@GMAIL.COM');

SELECT * FROM CLIENTE;

ALTER TABLE CLIENTE 
ADD MUNICIPIO VARCHAR2(30);

UPDATE CLIENTE SET MUNICIPIO = 'Guadalupe'
WHERE ID_CLIENTE = 1;
UPDATE CLIENTE SET MUNICIPIO = 'Guadalupe'
WHERE ID_CLIENTE = 2;
UPDATE CLIENTE SET MUNICIPIO = 'Guadalupe'
WHERE ID_CLIENTE = 3;
UPDATE CLIENTE SET MUNICIPIO = 'Zacatecas'
WHERE ID_CLIENTE = 4;
UPDATE CLIENTE SET MUNICIPIO = 'Fresnillo'
WHERE ID_CLIENTE = 5;

--TABLA AUTOMOVIL--
CREATE TABLE AUTOMOVIL(
ID_AUTOMOVIL CHAR(6) CONSTRAINT AUTOMOVIL_PK PRIMARY KEY,
MARCA VARCHAR2(50) CONSTRAINT MA_NN NOT NULL,
MODELO VARCHAR2(50) CONSTRAINT MO_NN NOT NULL,
LINEAAUTO VARCHAR2(50) CONSTRAINT LIN_A_NN NOT NULL, 
COLOR VARCHAR2(25) CONSTRAINT COL_NN NOT NULL
);
INSERT INTO AUTOMOVIL VALUES ('1','CHEVROLET','BEAT 2020','ESTANDAR','AZUL');
INSERT INTO AUTOMOVIL VALUES ('2','RENAULT','MEGAN 2009','ESTANDAR','ARENA');
INSERT INTO AUTOMOVIL VALUES ('3','JEEP','JEEP 2021','TODOTERRENO','VERDE');
INSERT INTO AUTOMOVIL VALUES ('4','MAZDA','MAZDA3 2021','DEPORTIVO','ROJO');
INSERT INTO AUTOMOVIL VALUES ('5','KIA','RIO 2021','DEPORTIVO','BLANCO');

SELECT * FROM AUTOMOVIL;

--TABLA AGENTE_VENTAS--
CREATE TABLE AGENTE_VENTAS(
ID_AGENTE CHAR(6) CONSTRAINT AGENTE_PK PRIMARY KEY,
NOMBRE VARCHAR2(50) CONSTRAINT NOM_A_NN NOT NULL,
APATERNO VARCHAR2(50) CONSTRAINT AP_A_NN NOT NULL,
AMATERNO VARCHAR2(50) CONSTRAINT AM_A_NN NOT NULL,
TELEFONO VARCHAR2(10) CONSTRAINT T_A_NN NOT NULL,
CORREO VARCHAR2(50),
COMISSION_VENTA VARCHAR(25) CONSTRAINT COM_VE_NN NOT NULL
);
INSERT INTO AGENTE_VENTAS VALUES('1','ARMANDO','MENDEZ','RUIZ','4923335567','AMR@GMAIL.COM','25%');
INSERT INTO AGENTE_VENTAS VALUES('2','LUIS','MENDEZ','CASTRO','4921217767','LMC@GMAIL.COM','30%');
INSERT INTO AGENTE_VENTAS VALUES('3','ISMAEL','MORALES','ROSALES','4921217597','IMM@GMAIL.COM','25%');
INSERT INTO AGENTE_VENTAS VALUES('4','CRISTIAN','SANCHEZ','ALMADA','4921778899','CSA@GMAIL.COM','10%');
INSERT INTO AGENTE_VENTAS VALUES('5','GUISTAVO','ZEPEDA','VALLES','4921773325','PE@GMAIL.COM','20%');

SELECT * FROM AGENTE_VENTAS;
ALTER TABLE AGENTE_VENTAS 
ADD SALARIO NUMBER(5,0);

UPDATE AGENTE_VENTAS SET SALARIO = 10000
WHERE ID_AGENTE = 1;
UPDATE AGENTE_VENTAS SET SALARIO = 13000
WHERE ID_AGENTE = 2;
UPDATE AGENTE_VENTAS SET SALARIO = 5000
WHERE ID_AGENTE = 3;
UPDATE AGENTE_VENTAS SET SALARIO = 7000
WHERE ID_AGENTE = 4;
UPDATE AGENTE_VENTAS SET SALARIO = 15000
WHERE ID_AGENTE = 5;



--TABLA TIPO_SEGURO
CREATE TABLE TIPO_SEGURO(
ID_TIPO_SEGURO CHAR(4) CONSTRAINT TIPO_SEGURO_PK PRIMARY KEY,
NOMBRE VARCHAR2(50) CONSTRAINT NOM_NN NOT NULL,
DESCRIPCION VARCHAR2(50) CONSTRAINT DES_NN NOT NULL
);
INSERT INTO TIPO_SEGURO VALUES('1','BRONCE','REPARACIONES');
INSERT INTO TIPO_SEGURO VALUES('2','PLATA','CHOQUES');
INSERT INTO TIPO_SEGURO VALUES('3','ORO','COMPOSTURA');
INSERT INTO TIPO_SEGURO VALUES('4','PLATINO','SEMICOMPLETO');
INSERT INTO TIPO_SEGURO VALUES('5','ONIX','COMPLETO');

SELECT * FROM TIPO_SEGURO;

--TABLA AJSTADOR
CREATE TABLE AJUSTADOR(
ID_AJUSTADOR CHAR(5) CONSTRAINT AJUSTADOR_PK PRIMARY KEY,
NOMBRE VARCHAR2(50) CONSTRAINT NOM_AJUSTADOR_NN NOT NULL,
APATERNO VARCHAR2(50) CONSTRAINT AP_AJ__NN NOT NULL,
AMATERNO VARCHAR2(50),
TELEFONO VARCHAR2(10),
CORREO VARCHAR2(50)
);
INSERT INTO AJUSTADOR VALUES('1','FERNANDO','CHAVEZ','ROMERO','4921217598','FCR@GMAIL.COM');
INSERT INTO AJUSTADOR VALUES('2','MARCO','SOSA','VAZQUEZ','4921217599','MSV@GMAIL.COM');
INSERT INTO AJUSTADOR VALUES('3','ARMANDO','TREJO','JHONSON','4921217500','ATJ@GMAIL.COM');
INSERT INTO AJUSTADOR VALUES('4','CAMILO','VARGAS','ROBLES','4921217587','CVR@GMAIL.COM');
INSERT INTO AJUSTADOR VALUES('5','ANDRES','CAMARILLO','SAMARRIPA','4921217593','ACS@GMAIL.COM');

SELECT * FROM AJUSTADOR;

--TABLA TIPO_ACCIDENTE
CREATE TABLE TIPO_ACCIDENTE(
ID_TIPO_ACCIDENTE CHAR(6) CONSTRAINT TIPO_ACCIDENTE_PK PRIMARY KEY,
NOMBRE VARCHAR2(50) CONSTRAINT TA_NOM_NN NOT NULL
);
INSERT INTO TIPO_ACCIDENTE VALUES('1','MENOR');
INSERT INTO TIPO_ACCIDENTE VALUES('2','LEVE');
INSERT INTO TIPO_ACCIDENTE VALUES('3','MEDIO');
INSERT INTO TIPO_ACCIDENTE VALUES('4','FUERTE');
INSERT INTO TIPO_ACCIDENTE VALUES('5','GRAVE');


SELECT * FROM TIPO_ACCIDENTE;
--TABLA TALLER
CREATE TABLE TALLER(
ID_TALLER CHAR(4) CONSTRAINT TALLER_PK PRIMARY KEY,
NOMBRE VARCHAR2(50) CONSTRAINT TALL_NOM_NN NOT NULL
);
INSERT INTO TALLER VALUES ('1','TALLER AMIGOS');
INSERT INTO TALLER VALUES ('2','TALLER ZAC');
INSERT INTO TALLER VALUES ('3','REPARACIONES T');
INSERT INTO TALLER VALUES ('4','TALLER EE');
INSERT INTO TALLER VALUES ('5','TALLER DEL LUIS');

SELECT * FROM TALLER;


--PROCESOS
--TABLA CLIUENTE_AUTOMOVIL
CREATE TABLE CLIENTE_AUTOMOVIL(
ID_CLIENTE CHAR(6),
ID_AUTOMOVIL CHAR(6),
FECHA DATE CONSTRAINT FECH_CA_NN NOT NULL
);

--CREANDO LLAVES CON ALTER TABLE
ALTER TABLE CLIENTE_AUTOMOVIL ADD CONSTRAINT CLIENTE_AUTOMOVIL_PK PRIMARY KEY(ID_CLIENTE);
ALTER TABLE CLIENTE_AUTOMOVIL ADD CONSTRAINT CLI_CA_FK FOREIGN KEY (ID_CLIENTE) REFERENCES CLIENTE(ID_CLIENTE);
ALTER TABLE CLIENTE_AUTOMOVIL ADD CONSTRAINT AUT_CA_FK FOREIGN KEY (ID_AUTOMOVIL) REFERENCES AUTOMOVIL(ID_AUTOMOVIL);

INSERT INTO CLIENTE_AUTOMOVIL VALUES('1','1','14-10-2020');
INSERT INTO CLIENTE_AUTOMOVIL VALUES('2','2','12-10-2020');
INSERT INTO CLIENTE_AUTOMOVIL VALUES('3','3','17-10-2020');
INSERT INTO CLIENTE_AUTOMOVIL VALUES('4','4','20-10-2020');
INSERT INTO CLIENTE_AUTOMOVIL VALUES('5','5','26-10-2020');


SELECT * FROM CLIENTE_AUTOMOVIL;
DROP TABLE CLIENTE_AUTOMOVIL;

--TABLA POLIZA 

CREATE TABLE POLIZA(
ID_POLIZA CHAR(6) CONSTRAINT ID_POLIZA_NN NOT NULL,
ID_AGENTE CHAR(6),
ID_TIPO_SEGURO CHAR(4),
ID_CLIENTE CHAR(6)
);

--CREANDO LLAVES CON ALTER TABLE
ALTER TABLE POLIZA ADD CONSTRAINT POLIZA_PK PRIMARY KEY(ID_POLIZA);
ALTER TABLE POLIZA ADD CONSTRAINT AGENTE_PO_FK FOREIGN KEY (ID_AGENTE) REFERENCES AGENTE_VENTAS(ID_AGENTE);
ALTER TABLE POLIZA ADD CONSTRAINT TS_PO_FK FOREIGN KEY (ID_TIPO_SEGURO) REFERENCES TIPO_SEGURO(ID_TIPO_SEGURO);
ALTER TABLE POLIZA ADD CONSTRAINT DLIE_PO_FK FOREIGN KEY (ID_CLIENTE) REFERENCES CLIENTE(ID_CLIENTE);

INSERT INTO POLIZA VALUES('PO1','1','1','1');
INSERT INTO POLIZA VALUES('PO2','2','2','2');
INSERT INTO POLIZA VALUES('PO3','3','3','3');
INSERT INTO POLIZA VALUES('PO4','4','3','4');
INSERT INTO POLIZA VALUES('PO5','5','4','5');

SELECT * FROM POLIZA;
DROP TABLE POLIZA;

--PAGO_POLIZA
CREATE TABLE PAGO_POLIZA(
ID_PAGO_POLIZA CHAR(6),
ID_POLIZA CHAR(6),
FECHA DATE
);
--CREANDO LLAVES CON ALTER TABLE
ALTER TABLE PAGO_POLIZA ADD CONSTRAINT ID_PP_PK PRIMARY KEY(ID_PAGO_POLIZA);
ALTER TABLE PAGO_POLIZA ADD CONSTRAINT ID_P_FK FOREIGN KEY (ID_POLIZA) REFERENCES POLIZA(ID_POLIZA);

INSERT INTO PAGO_POLIZA VALUES('PP1','PO1','15-11-2021');
INSERT INTO PAGO_POLIZA VALUES('PP2','PO2','17-11-2021');
INSERT INTO PAGO_POLIZA VALUES('PP3','PO3','20-11-2021');
INSERT INTO PAGO_POLIZA VALUES('PP4','PO4','25-11-2021');
INSERT INTO PAGO_POLIZA VALUES('PP5','PO5','2-11-2021');

SELECT * FROM PAGO_POLIZA;

DROP TABLE PAGO_POLIZA;

--TABLA ACCIDENTE
CREATE TABLE ACCIDENTE(
ID_ACCIDENTE CHAR(6),
ID_POLIZA CHAR(6),
ID_AJUSTADOR CHAR(5),
ID_TIPO_ACCIDENTE CHAR(6),
DETALLES VARCHAR2(50)
);
DROP TABLE ACCIDENTE;
SELECT * FROM ACCIDENTE;
--CREANDO LLAVES CON ALTER TABLE
ALTER TABLE ACCIDENTE ADD CONSTRAINT ACC_PK PRIMARY KEY(ID_ACCIDENTE);
ALTER TABLE ACCIDENTE ADD CONSTRAINT ACC_PO_FK FOREIGN KEY (ID_POLIZA) REFERENCES POLIZA(ID_POLIZA);
ALTER TABLE ACCIDENTE ADD CONSTRAINT ACC_AJ_FK FOREIGN KEY (ID_AJUSTADOR) REFERENCES AJUSTADOR(ID_AJUSTADOR);
ALTER TABLE ACCIDENTE ADD CONSTRAINT ACC_TA_FK FOREIGN KEY (ID_TIPO_ACCIDENTE) REFERENCES TIPO_ACCIDENTE(ID_TIPO_ACCIDENTE);


INSERT INTO ACCIDENTE VALUES ('ACC1','PO1','1','1','CHOQUE LEVE');
INSERT INTO ACCIDENTE VALUES ('ACC2','PO2','2','2','CHOQUE CON ALGUNOS DETALLES');
INSERT INTO ACCIDENTE VALUES ('ACC3','PO3','3','3','CHOQUE CON DESTRUCCION');
INSERT INTO ACCIDENTE VALUES ('ACC4','PO4','4','4','PERDIDA DE PARTES');
INSERT INTO ACCIDENTE VALUES ('ACC5','PO5','5','5','PERDIDA TOTAL');


SELECT * FROM ACCIDENTE;

--TABLA REPARACION
CREATE TABLE REPARACION(
NUM_REPARACION CHAR(6),
ID_ACCIDENTE CHAR(6),
ID_TALLER CHAR(4)
);

--CREANDO LLAVES CON ALTER TABLE
ALTER TABLE REPARACION ADD CONSTRAINT NR_PK PRIMARY KEY(NUM_REPARACION);
ALTER TABLE REPARACION ADD CONSTRAINT ACC_REP_FK FOREIGN KEY (ID_ACCIDENTE) REFERENCES ACCIDENTE(ID_ACCIDENTE);
ALTER TABLE REPARACION ADD CONSTRAINT ACC_TALLER_FK FOREIGN KEY (ID_TALLER) REFERENCES TALLER(ID_TALLER);

INSERT INTO REPARACION VALUES('REP1','ACC1','1');
INSERT INTO REPARACION VALUES('REP2','ACC2','1');
INSERT INTO REPARACION VALUES('REP3','ACC3','2');
INSERT INTO REPARACION VALUES('REP4','ACC4','3');
INSERT INTO REPARACION VALUES('REP5','ACC5','3');


SELECT * FROM REPARACION;

--CUADERNILLO DE CONSULTAS 
--1. CONSULTAR LOS DATOS GENERALES DE TODOS LOS CLIENTES
SELECT * FROM CLIENTES;
--2. CONSULTAR LOS NOMBRE COMPLETOS DE LOS AGENTES DE VENTA EN UNA SOLA COLUMNA
SELECT * FROM AGENTE_VENTAS;
--3. CONSULTAR EL SALARIO ANUAL DE LOS AGENTES DE VENTA
SELECT * FROM AGENTE_VENTAS;
SELECT APATERNO, AMATERNO, NOMBRE, TELEFONO,CORREO, SALARIO * 12 AS SALARIO_ANUAL FROM AGENTE_VENTAS;
--4. CONSULTAR LOS DATOS GENERALES DE TODOS LOS VEHICULOS DE UNA DETERMINADA MARCA
SELECT * FROM AUTOMOVIL;
SELECT * FROM AUTOMOVIL WHERE MARCA = 'JEEP';
--5. CONSULTAR LOS DATOS GENERALES DE LOS AGENTES DE VENTA CUYO SALARIO ESTE ENTRE 5000 Y 10000
SELECT * FROM AGENTE_VENTAS;
SELECT * FROM AGENTE_VENTAS WHERE SALARIO BETWEEN 5000 AND 10000;
--6. CONSULTAR EL TOTAL DE POLIZAS GENERADAS
SELECT * FROM POLIZA;
SELECT COUNT(*) AS TOTAL_POLIZAS FROM POLIZA;
--7. CONSULTAR EL TOTAL DE CLIENTES REGISTRADOS EN CADA MUNICIPIO 
SELECT * FROM CLIENTE;
SELECT MUNICIPIO, COUNT(*) AS NUMERO FROM CLIENTE GROUP BY MUNICIPIO;
--8. CONSULTAR EL NOMBRE COMPLETO DE LOS CLIENTES QUE TIENEN AUTOMOVIL
SELECT APATERNO, AMATERNO, NOMBRE FROM CLIENTE C JOIN CLIENTE_AUTOMOVIL CA ON C.ID_CLIENTE = CA.ID_CLIENTE;

--9 CONSULTAR LOS DATOS GEENERALES DE LAS POLIZAS (DATOS GEBNERALES DE TODAS LAS TABLAS RELACIONADAS)
SELECT * FROM POLIZA;
SELECT P.ID_POLIZA AS POLIZA,C.ID_CLIENTE, C.APATERNO,C.AMATERNO, C.NOMBRE AS CLIENTE,
AGV.ID_AGENTE,AGV.APATERNO, AGV.AMATERNO, AGV.NOMBRE AS AGENTE_VENTAS,TS.ID_TIPO_SEGURO,TS.NOMBRE AS SEGURO, A.ID_AUTOMOVIL, A.MARCA, A.MODELO AS AUTOMOVIL
FROM CLIENTE C JOIN CLIENTE_AUTOMOVIL CA ON C.ID_CLIENTE = CA.ID_CLIENTE JOIN AUTOMOVIL A ON A.ID_AUTOMOVIL = CA.ID_AUTOMOVIL JOIN POLIZA P ON CA.ID_CLIENTE = P.ID_CLIENTE AND
CA.ID_AUTOMOVIL = CA.ID_AUTOMOVIL JOIN AGENTE_VENTAS AGV ON AGV.ID_AGENTE = P.ID_AGENTE JOIN TIPO_SEGURO TS ON TS.ID_TIPO_SEGURO = P.ID_TIPO_SEGURO;
--10 CONSULTAR LOS DATOS GENERALES DE LOS ACCIDENTES
SELECT AC.ID_ACCIDENTE, AC.DETALLES AS ACCIDENTE,  P.ID_POLIZA AS POLIZA, AJ.ID_AJUSTADOR, AJ.NOMBRE, AJ.APATERNO, AJ.AMATERNO, AJ.TELEFONO, AJ.CORREO AS AJUSTADOR, 
TA.ID_TIPO_ACCIDENTE, TA.NOMBRE AS TIPO_ACCIDENTE FROM ACCIDENTE AC JOIN POLIZA P ON AC.ID_POLIZA = P.ID_POLIZA JOIN AJUSTADOR AJ ON AC.ID_AJUSTADOR = AJ.ID_AJUSTADOR
JOIN TIPO_ACCIDENTE TA ON TA.ID_TIPO_ACCIDENTE = AC.ID_TIPO_ACCIDENTE;
--11 CONSULTAR LOS DATOS GENERALES DEL TALLER QUE REPARON ALGUN DETERMINADO AUTOMOVIL
SELECT * FROM TALLER;
SELECT ID_TALLER, NOMBRE FROM TALLER;
SELECT NUM_REPARACION,ID_ACCIDENTE, T.NOMBRE FROM REPARACION R JOIN TALLER T ON R.ID_TALLER = T.ID_TALLER;
--12. CONSULTAR EL TOTAL DE AUTOMOVILES QUE TIENE CADA CLIENTE
SELECT APATERNO, AMATERNO, NOMBRE, COUNT(*) AS TOTAL_AUTOS FROM CLIENTE C JOIN CLIENTE_AUTOMOVIL CA ON C.ID_CLIENTE = CA.ID_CLIENTE
GROUP BY APATERNO, AMATERNO, NOMBRE;
--13.CONSULTAR EL TOTALD E PÓLIZAS QUE HA VENDIDO CADA EMPLEADO
SELECT APATERNO, AMATERNO, NOMBRE, COUNT(*) AS POLIZAS_POR_EMPLEADO 
FROM AGENTE_VENTAS AGV JOIN POLIZA P ON AGV.ID_AGENTE = P.ID_AGENTE GROUP BY APATERNO, AMATERNO, NOMBRE;
--14.CONSULTAR EL TOTAL DE PÓLIZAS EMITIDAS POR CADA TIPO DE SEGURO.
SELECT TS.ID_TIPO_SEGURO, TS.NOMBRE, COUNT(*) AS POLIZAS_EMITIDAS FROM TIPO_SEGURO TS
JOIN POLIZA P ON TS.ID_TIPO_SEGURO = P.ID_TIPO_SEGURO GROUP BY TS.ID_TIPO_SEGURO, TS.NOMBRE;
--15 CONSULTAR EL TOTAL DE ACCIDENTES QUE HAYA TENIDO CADA AJUSTADOR
SELECT * FROM AJUSTADOR;
SELECT * FROM ACCIDENTE;
SELECT APATERNO, AMATERNO, NOMBRE AS AJUSTADOR, COUNT(*) AS TOTAL_ACCIDENTES_AJUSTADOR FROM AJUSTADOR A
JOIN ACCIDENTE AC ON A.ID_AJUSTADOR = AC.ID_AJUSTADOR GROUP BY APATERNO, AMATERNO, NOMBRE;

--16 CONSULTAR EL NOMBRE DE LOS EMPLEADOS QUE NO HAN VENDIDO POLIZAS
SELECT ID_AGENTE, APATERNO, AMATERNO, NOMBRE FROM AGENTE_VENTAS WHERE ID_AGENTE NOT IN (SELECT ID_AGENTE FROM POLIZA);

--17 CONSULTAR EL NOMBRE DE LOS CLIENTES QUE NO TIENEN AUTOMOVIL ASIGADO
SELECT APATERNO,  AMATERNO, NOMBRE AS SIN_AUTO_ASIGNADO FROM CLIENTE
WHERE ID_CLIENTE NOT IN (SELECT ID_CLIENTE FROM CLIENTE_AUTOMOVIL);

--18 CONSULTAR EL TIPO DE SEGURO QUE NO SE HA VENDIDO
SELECT * FROM TIPO_SEGURO;
SELECT ID_TIPO_SEGURO, NOMBRE AS NO_VENDIDO FROM TIPO_SEGURO WHERE ID_TIPO_SEGURO NOT IN (SELECT ID_TIPO_SEGURO FROM POLIZA);
--19 CONSULTAR LOS DATOS GENERALES DE LOS AJUSTADORES QUE NO HAN TENIDO ACCIDENTES
SELECT * FROM AJUSTADOR WHERE ID_AJUSTADOR NOT IN (SELECT ID_AJUSTADOR FROM ACCIDENTE);
--20  CONSULTAR EL NOMBRE COMPLETO DE LOS CLIENTES QUE NO SE HAN ACCIDENTADO
SELECT * FROM ACCIDENTE;
SELECT APATERNO, AMATERNO, NOMBRE AS NO_ACCIDENTES FROM CLIENTE WHERE ID_CLIENTE NOT IN (SELECT ID_CLIENTE FROM ACCIDENTE);
--21 CONSULTAR EL TALLER QUE NO HA REPARADO AUTOMOVILES
SELECT * FROM REPARACION;
SELECT NOMBRE AS NO_REPARADOS FROM TALLER  WHERE ID_TALLER NOT IN (SELECT ID_TALLER FROM REPARACION);
--22 
SELECT *FROM AUTOMOVIL;
SELECT * FROM CLIENTE_AUTOMOVIL;
--23
--SOILO ME FALTARON ESTAS DOS CONSULTAS, LO QUE PASO ES QUE EN LA PRÁCTICA DE LA CRACION DE BASE DE DATOS NO AGREGUÉ EL SEGURO A ESTA RELACION, Y SI QUIERO MODIFICAR CON ALTER NO SE PUEDE POR TENER LLAVE
--FORANEA
--24 CONSULTAR EL NOMBRE COMPLETO DE LOS CLIENTES QUE MAS AUTOMOVILES TIENEN
SELECT * FROM CLIENTE;
SELECT * FROM CLIENTE_AUTOMOVIL;
SELECT APATERNO, AMATERNO, NOMBRE, COUNT(*) AS TOTAL_AUTOS FROM CLIENTE C JOIN CLIENTE_AUTOMOVIL CA ON C.ID_CLIENTE = CA.ID_CLIENTE 
GROUP BY APATERNO, AMATERNO, NOMBRE
HAVING COUNT(*) = (SELECT MAX(COUNT(*)) AS TOTAL_AUTOS FROM CLIENTE C JOIN CLIENTE_AUTOMOVIL CA ON C.ID_CLIENTE = CA.ID_CLIENTE GROUP BY APATERNO, AMATERNO, NOMBRE);
--25 CONSULTAR EL NOMBRE COMPLETO DE LOS CLIENTES QUE MAS SE HAN ACCIDENTADO
--26 CONSULTAR EL NOMBRE COMPLETO DE LOS CLIENTES QUE HAN TENIDO MAS DE 2 SEGUROS
SELECT * FROM CLIENTE;
SELECT * FROM POLIZA;
SELECT APATERNO, AMATERNO, NOMBRE, COUNT(*) AS CLIENTE FROM CLIENTE C JOIN POLIZA P ON C.ID_CLIENTE = P.ID_CLIENTE
GROUP BY APATERNO, AMATERNO, NOMBRE
HAVING COUNT(*)>2;

--27 CONSULTAR EL NOMBRE DEL AGENTE DE VENTAS QUE MAS SEGUROS HA VENDIDO
SELECT * FROM AGENTE_VENTAS;
SELECT * FROM POLIZA;
SELECT APATERNO, AMATERNO, NOMBRE, COUNT(*) AS TOTAL FROM AGENTE_VENTAS AGV JOIN POLIZA P ON AGV.ID_AGENTE = P.ID_AGENTE
GROUP BY APATERNO, AMATERNO, NOMBRE
HAVING COUNT(*) = (SELECT MAX(COUNT(*)) AS TOTAL FROM AGENTE_VENTAS AGV JOIN POLIZA P ON AGV.ID_AGENTE = P.ID_AGENTE GROUP BY APATERNO, AMATERNO, NOMBRE);

--28 CONSULTAR EL TIPO DE SEGURO MÁS VENDIDO 
SELECT * FROM TIPO_SEGURO;
SELECT NOMBRE, COUNT(*) AS TOTAL FROM TIPO_SEGURO TS JOIN POLIZA P ON TS.ID_TIPO_SEGURO = P.ID_TIPO_SEGURO
GROUP BY NOMBRE HAVING COUNT(*) = (SELECT MAX(COUNT(*)) AS TOTAL FROM TIPO_SEGURO TS JOIN POLIZA P ON TS.ID_TIPO_SEGURO = P.ID_TIPO_SEGURO GROUP BY NOMBRE);
--29 CONSULTAR EL NOMBRE COMPLETO DEL EMPLEADO QUE MENOS POLIZAS HA VENDIDO 
SELECT * FROM POLIZA;
SELECT APATERNO, AMATERNO, NOMBRE, COUNT(*) AS TOTAL FROM AGENTE_VENTAS AGV JOIN POLIZA P ON AGV.ID_AGENTE = P.ID_AGENTE
GROUP BY APATERNO, AMATERNO, NOMBRE
HAVING COUNT(*) = (SELECT MIN(COUNT(*)) AS TOTAL FROM AGENTE_VENTAS AGV JOIN POLIZA P ON AGV.ID_AGENTE = P.ID_AGENTE GROUP BY APATERNO, AMATERNO, NOMBRE);

--30 CONSULTAR EL NOMBRE DEL TALLER QUE MÁS AUTOS HA REPARADO
SELECT NOMBRE, COUNT(*) AS MAS_REPARACION FROM REPARACION R JOIN TALLER T ON R.ID_TALLER = T.ID_TALLER
GROUP BY NOMBRE HAVING COUNT(*) = (SELECT MAX(COUNT(*)) AS MAS_REPARACION FROM REPARACION R JOIN TALLER T ON T.ID_TALLER = R.ID_TALLER GROUP BY NOMBRE);









SELECT * FROM TIPO_SEGURO;
SELECT NOMBRE, COUNT(*) AS TOTAL FROM TIPO_SEGURO TS JOIN POLIZA P ON TS.ID_TIPO_SEGURO = P.ID_TIPO_SEGURO
GROUP BY NOMBRE HAVING COUNT(*) = (SELECT MIN(COUNT(*)) AS TOTAL FROM TIPO_SEGURO TS JOIN POLIZA P ON TS.ID_TIPO_SEGURO = P.ID_TIPO_SEGURO GROUP BY NOMBRE);



